<style>
    /*
    We cannot wait for the script to load using a link tag, otherwise we get graphics glitches.
    This is why the script is inline. Not to mention the link tag goes in the head, not the body,
    and the head is already loaded.
    /*

    /* Make sure that there is even spacing between the form fields and submit buttons */

    /* Make sure that there is even spacing between the form fields and submit buttons */
    #signup-form>div:last-child
    {
        margin-bottom: 0px;
    }
    .modal-title
    {
        margin-bottom: 10px;
    }

</style>

<div class="container modal-container">
  <div class="modal-header">
    <h4 class="modal-title">Sign Up for Crowdsurfer</h4>
    <!-- Below we include the Login Button social plugin. This button uses the JavaScript SDK to
         present a graphical Login button that triggers the FB.login() function when clicked. -->
        <!-- Keep show faces set to false so login button appears when user is already logged in.
             They have not necessarily linked their Crowdsurfer account to their FB account. -->
    <fb:login-button id="fb-login-button" show-faces="false" data-auto-logout-link="true"
                     perms="email" size="large" width="200" max-rows="1"></fb:login-button>

  </div>

  <div class="modal-body">
    <form id="signup-form" class="form-horizontal">

      <div class="form-group">
        <label for="signup-first-name" class="control-label sr-only"></label>
        <input id="signup-first-name" class="form-control{% if is_bound_form %} has-feedback{% endif %}"
               type="text" name="first_name" placeholder="First Name" required

               data-bv-notempty-message="{{ form_settings.FIRST_NAME_NOTEMPTY_MESSAGE }}"

               pattern="{{ form_settings.FIRST_NAME_REGEXP }}"
               data-bv-regexp-message="{{ form_settings.FIRST_NAME_REGEXP_MESSAGE }}"

               data-bv-stringlength="true"
               data-bv-stringlength-max="{{ form_settings.FIRST_NAME_MAX_LENGTH }}"
               data-bv-stringlength-message="{{ form_settings.FIRST_NAME_LENGTH_MESSAGE }}">

          {% if is_bound_form %}
          <i class="form-control-feedback{% if errors.first_name %} glyphicon glyphicon-remove{% else %} glyphicon glyphicon-ok{% endif %}"
             data-bv-field="from_email_address" style="display: block;"></i>
          <small class="help-block" style="display: block;">{{ errors.first_name }}</small>
          {% endif %}
      </div>

      <div class="form-group">
        <label for="signup-last-name"  class="control-label sr-only"></label>
        <input id="signup-last-name" type="text" class="form-control"  name="last_name" placeholder="Last Name" required

          data-bv-notempty-message="{{ form_settings.LAST_NAME_NOTEMPTY_MESSAGE }}"

          pattern="{{ form_settings.LAST_NAME_REGEXP }}"
          data-bv-regexp-message="{{ form_settings.LAST_NAME_REGEXP_MESSAGE }}"

          data-bv-stringlength="true"
          data-bv-stringlength-max="{{ form_settings.LAST_NAME_MAX_LENGTH }}"
          data-bv-stringlength-message="{{ form_settings.LAST_NAME_LENGTH_MESSAGE }}">
      </div>  <!-- form group -->

      <div class="form-group">
        <label for="signup-email" class="control-label sr-only"></label>
        <input type="email" class="form-control" id="signup-email" name="email" placeholder="Email Address" required

          data-bv-notempty-message="{{ form_settings.EMAIL_NOTEMPTY_MESSAGE }}"
          data-bv-emailaddress-message="{{ form_settings.EMAIL_EMAILADDRESS_MESSAGE }}"

          data-bv-stringlength="true"
          data-bv-stringlength-max="{{ form_settings.EMAIL_MAXLENGTH }}"
          data-bv-stringlength-message="{{ form_settings.EMAIL_LENGTH_MESSAGE }}">
      </div>

      <div class="form-group">
        <label for="signup-password" class="control-label sr-only"></label>
        <input type="password" class="form-control" id="signup-password" name="password" placeholder="Password" required

          data-bv-notempty-message="{{ form_settings.PASSWORD_NOTEMPTY_MESSAGE }}"

          data-bv-stringlength="true"
          data-bv-stringlength-min="{{ form_settings.PASSWORD_MIN_LENGTH }}"
          data-bv-stringlength-max="{{ form_settings.PASSWORD_MAX_LENGTH }}"
          data-bv-stringlength-message="{{ form_settings.PASSWORD_LENGTH_MESSAGE }}">
      </div>  <!-- form group -->
    </form>  <!-- signup form -->
  </div>  <!-- modal body -->

    <div class="modal-footer">
        <!-- Notice that the button type is button, not submit. This is because the request is submitted via AJAX using
             an bound onclick event in signup.js. -->
        <button id="signup-form-button" class='btn btn-primary form-submit-button' form="signup-form" type="button">Sign up</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>
  </div>

{% comment %} <script type="text/javascript" src="{{ STATIC_URL }}registration/js/signup.js"></script> {% endcomment %}

<!-- TODO I didn't want to load this in a separate file from base.html because the form won't exist yet, so it wouldn't
     work. Need to figure out dependency management... aka requireJS -->
<script>
    $('#signup-form').bootstrapValidator({
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        submitButtons: $(".form-submit-button"),

        submitHandler: function(validator, form, submitButton) {
            var fb_uid = '';
            if (send_fbuid()) {
                fb_uid = window.sessionStorage.fb_uid
            };

            $.ajax({
                type: 'POST',
                url: 'registration/signup/',
                data: {first_name: $('#signup-first-name').val(),
                       last_name: $('#signup-last-name').val(),
                       email: $('#signup-email').val(),
                       password: $('#signup-password').val(),
                       fb_uid: fb_uid,
                       fb_access_token: window.sessionStorage.fb_access_token
                      },
                dataType: 'json',
                success: function (json_response) {
                    if (json_response) {
                        handle_ajax_response(json_response); // Defined in base.js
                        // We are now logged in seeing the appropriate content. No need to keep the signup form around.
                        $('#modal-signup-form').modal('hide');
                    }
                }
            });
        }
    });
</script>