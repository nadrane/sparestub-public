{% extends "user_profile/base_profile.html" %}
{% load tz %}
{% load static %}
{% load humanize %}
{% load misc_filters %}
{% load l10n %}

{% block css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "user_profile/css/view_ticket.css" %}">
{% endblock %}

{% block profile_body %}
  <div class="panel panel-primary tickets-review-panel">
    <div class="panel-heading">
      <a style="color:#ffffff" href="{% url "profile_tickets" username=user_info.username %}"><span class="glyphicon glyphicon-arrow-left"></span>  See All User's Tickets</a>
    </div>
    <div id="ticket-contents" class="panel-body">
      <div id="row-top" class="row">
        <div class="col-xs-12">
          <h2 id="ticket-title">{{ ticket.title}}</h2>
        </div>
      </div>
      <div id="row-middle" class="row">
        <div id="left-middle" class="col-xs-2 middle-contents">
          <div class="middle-label">Where: </div>
          <div class="middle-item">{{ ticket.location }}<br>{{ ticket.venue }}</div>
        </div>
        <div id="mid-middle" class="col-xs-2 middle-contents">
          <div class="middle-label">When: </div>
            {% comment %}Turn localtimeoff because the events might be in a different timezone than the user. We don't want to
            convert the event time to the timezone of the user but to the timezone of the event's location.
            Ticket.get_formatted_start_datetime does this for us. Django will undo the change if localtime is on {% endcomment %}
          <div class="middle-item">{% localtime off %}{{ ticket.get_formatted_start_datetime|date:"D N d, P" }}{% endlocaltime %}</div>
        </div>
        <div id="right-middle" class="col-xs-2 middle-contents">
            <div class="middle-label">Price: </div>
            <div class="middle-item">{{ ticket.price | currency}}</div>
        </div>
      </div>
      <div id="about" class="row">
        <div class="col-xs-6">
          {{ ticket.about }}
        </div>
      </div>
      <div id="request-to-buy-errors" class="row" style="display:none;">
        <div class="col-xs-12">
          <div class="alert alert-danger">
            <p></p>
          </div>
        </div>
      </div>
      <div id="buy-or-message-buttons" class="row">
        <div class="col-xs-12">
          {% if is_owner %}
            <button id="delete-ticket" type=button class="btn btn-primary cancel-ticket" type="button"
                    data-toggle="modal" data-target="#modal-yes-cancel-root">Delete Ticket</button>
          {% else %}
            <button id="request-to-buy" class="btn btn-primary">Request To Buy</button>
            <button class="btn btn-default message-user" type="button">Message User</button>
            {% if ticket.is_buy_it_now_enabled %}
              <button id="buy-it-now" class="btn btn-default" type="button">Buy It Now</button>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block js %}
  {% with ticket_id=ticket.id %}
    <script type="text/javascript">
        window.additional_parameters.can_request_ticket_url = "{% url "can_request_ticket" ticket_id=ticket_id %}"
        window.additional_parameters.request_to_buy_url = "{% url "request_to_buy" %}";
        window.additional_parameters.stripe_public_key = "{{ stripe_public_api_key }}";
        window.additional_parameters.ticket_id = "{{ ticket.id }}";
        window.additional_parameters.ticket_amount = "{{ ticket.price }}";
        window.additional_parameters.ticket_title = "{{ ticket.title }}";
        window.additional_parameters.user_id = "{{ user_info.user_id }}";
        window.additional_parameters.user_email = "{{ user_info.email }}";
        window.additional_parameters.send_message_url = "{% url "send_message" %}";
        window.additional_parameters.message_user_form_url = "{% url "message_user_modal" ticket_id=ticket_id %}";
        window.additional_parameters.delete_ticket_url = "{% url "delete_ticket" ticket_id=ticket_id %}";
    </script>
  {% endwith %}
  {{ block.super }}
  <script src="https://checkout.stripe.com/checkout.js"></script>
  <script type="text/javascript" src="{% static "user_profile/js/view_ticket.js" %}"></script>
{% endblock %}

{% block modals %}
  {{ block.super }}
   <!-- TODO aria-labeledby we need to set this appropriately -->
   <div id="modal-message-user-root" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-sm">
      <div class="modal-content" id="modal-message-user-form-content"></div>
    </div>
  </div>
{% endblock %}